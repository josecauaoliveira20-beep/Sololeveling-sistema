<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solo Leveling: Eternal System</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00e5ff; --bg: #050505; --punish: #ff0055; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Orbitron', sans-serif; overflow: hidden; }
        
        #menu { position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .btn-missao { background: rgba(0,229,255,0.1); border: 1px solid var(--neon); color: var(--neon); padding: 15px; margin: 8px; width: 85%; font-size: 14px; text-transform: uppercase; cursor: pointer; transition: 0.3s; }
        .btn-missao:active { background: var(--neon); color: black; }
        
        .status-header { margin-bottom: 20px; border: 1px solid var(--neon); padding: 15px; width: 80%; box-shadow: 0 0 15px rgba(0,229,255,0.3); }

        /* HUD Puni√ß√£o */
        #punishment-screen { position: absolute; width: 100%; height: 100%; background: rgba(50,0,0,0.9); z-index: 20; display: none; flex-direction: column; align-items: center; justify-content: center; border: 10px double var(--punish); box-sizing: border-box; }
        
        #video-container { position: relative; width: 100vw; height: 100vh; display: none; }
        video, canvas { position: absolute; width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        .xp-bar { position: absolute; bottom: 20px; left: 10%; width: 80%; height: 8px; border: 1px solid var(--neon); z-index: 5; background: rgba(0,0,0,0.5); }
        #xp-fill { width: 0%; height: 100%; background: var(--neon); box-shadow: 0 0 10px var(--neon); transition: 0.4s; }
    </style>
</head>
<body>

<div id="punishment-screen">
    <h1 style="color: var(--punish); text-shadow: 0 0 20px var(--punish);">PUNI√á√ÉO DO SISTEMA</h1>
    <p style="padding: 20px;">VOC√ä FALHOU EM MANTER A DISCIPLINA. XP REDUZIDO.</p>
    <button class="btn-missao" style="border-color: var(--punish); color: var(--punish);" onclick="aceitarPunicao()">ACEITAR E CONTINUAR</button>
</div>

<div id="menu">
    <div class="status-header">
        <h1 style="margin:0; font-size: 20px; color: var(--neon);">STATUS DO JOGADOR</h1>
        <div id="player-lvl" style="font-size: 24px; margin: 10px 0;">N√çVEL: 01</div>
        <div id="xp-text" style="font-size: 12px; color: var(--neon);">XP: 0/100</div>
    </div>
    <button class="btn-missao" onclick="iniciarTreino('flexao')">Miss√£o: Flex√µes</button>
    <button class="btn-missao" onclick="iniciarTreino('agachamento')">Miss√£o: Agachamentos</button>
    <label class="btn-missao" style="display: block; width: 77%;">
        <input type="file" id="musicInput" accept="audio/*" multiple style="display:none">
        M√∫sicas do Celular üéµ
    </label>
</div>

<div id="video-container">
    <video id="input_video"></video>
    <canvas id="output_canvas"></canvas>
    <div class="xp-bar"><div id="xp-fill"></div></div>
</div>

<audio id="bgMusic" loop></audio>

<script>
let xp = parseInt(localStorage.getItem('system_xp')) || 0;
let level = parseInt(localStorage.getItem('system_level')) || 1;
let lastTrain = localStorage.getItem('last_train_date');
let count = 0;
let stage = 'up';

// L√≥gica de Puni√ß√£o
function verificarPunicao() {
    if (lastTrain) {
        let diff = Date.now() - parseInt(lastTrain);
        let horas = diff / (1000 * 60 * 60);
        
        if (horas > 24) {
            xp = Math.max(0, xp - 30); // Perde 30 de XP
            document.getElementById('punishment-screen').style.display = 'flex';
            falar("Aviso. Voc√™ foi punido por neglig√™ncia. XP reduzido.");
            salvarProgresso();
        }
    }
}

function aceitarPunicao() {
    document.getElementById('punishment-screen').style.display = 'none';
    atualizarUI();
}

function salvarProgresso() {
    localStorage.setItem('system_level', level);
    localStorage.setItem('system_xp', xp);
    localStorage.setItem('last_train_date', Date.now().toString());
}

function atualizarUI() {
    document.getElementById('player-lvl').innerText = "N√çVEL: " + level.toString().padStart(2, '0');
    document.getElementById('xp-text').innerText = `XP: ${xp}/100`;
    document.getElementById('xp-fill').style.width = xp + "%";
}

function falar(t) {
    const s = new SpeechSynthesisUtterance(t);
    s.lang = 'pt-BR';
    window.speechSynthesis.speak(s);
}

// Configura√ß√£o de M√∫sica
const musicInput = document.getElementById('musicInput');
const bgMusic = document.getElementById('bgMusic');
musicInput.onchange = (e) => {
    const url = URL.createObjectURL(e.target.files[0]);
    bgMusic.src = url;
};

function iniciarTreino(tipo) {
    tipoTreino = tipo;
    document.getElementById('menu').style.display = 'none';
    document.getElementById('video-container').style.display = 'block';
    if(bgMusic.src) bgMusic.play();
    falar("Iniciando monitoramento de " + tipo);
    startCamera();
}

// MediaPipe e L√≥gica de Movimento (Igual ao anterior...)
const pose = new Pose({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`});
pose.setOptions({ modelComplexity: 1, minDetectionConfidence: 0.5, minTrackingConfidence: 0.5 });
pose.onResults((results) => {
    if (results.poseLandmarks) {
        const lm = results.poseLandmarks;
        let detect = (tipoTreino === 'flexao') ? (lm[13].y > lm[11].y + 0.1) : (lm[25].y < lm[23].y + 0.15);
        
        if (detect && stage === 'up') stage = 'down';
        if (!detect && stage === 'down') {
            stage = 'up';
            count++;
            xp += 10;
            if(xp >= 100) { xp = 0; level++; falar("Level up!"); }
            atualizarUI();
            salvarProgresso();
        }
    }
});

function startCamera() {
    new Camera(document.getElementById('input_video'), {
        onFrame: async () => { await pose.send({image: document.getElementById('input_video')}); },
        width: 640, height: 480
    }).start();
}

verificarPunicao();
atualizarUI();
</script>
</body>
</html>
